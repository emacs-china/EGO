<!DOCTYPE html>
<html lang="en">
<head>
  <title>EGO 使用手册 - EGO</title>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <meta name="author" content="皐月中二" />
  <meta name="description" content="EGO Manual" />
  <style>
   #ds-thread #ds-reset .ds-comment-body p {color: #ffffff;}
   #ds-thread #ds-reset .ds-comment-body p a {color: #ff0;}
   #ds-thread #ds-reset .ds-comment-body p a:hover {color: #0ff;}
   #disqus_thread a {color: #00ffff;}
  </style>
  <link rel="stylesheet" href="http://emacs-china.github.io/EGO/media/css/main.css" type="text/css">
  <link rel="stylesheet" href="http://emacs-china.github.io/EGO/media/css/comment.css" type="text/css">
  <script type="text/javascript"
          src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_SVG">
  </script>
  <script type="text/x-mathjax-config">
          MathJax.Hub.Config({ TeX: { equationNumbers: {autoNumber: "AMS"} } });
  </script>
</head>

  <body><div class="container">
<div>
  <header class="masthead">
    <h1 class="masthead-title"><a href="http://emacs-china.github.io/EGO/">EGO</a></h1>
    <p>Static site generator based on Emacs, Git and Org-mode</p>
    <nav class="site-nav">
      <div class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z" fill="#ffff00"/>
          <path d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z" fill="#ffff00"/>
          <path d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z" fill="#ffff00"/>
        </svg>
      </div>
      <ul class="trigger">
        <li><a href="http://emacs-china.github.io/EGO/about/">About</a></li>
        <li><a href="https://github.com/emacs-china/ego">GitHub</a></li>
        <li><a href="http://emacs-china.github.io/EGO/rss.xml">RSS</a></li>
      </ul>
    </nav>
    <form method="get" id="searchform" action="http://www.google.com/search">
      <input type="text" class="field" name="q" id="s" placeholder="Search">
      <input type="hidden" name="as_sitesearch" value="emacs-china.github.io/EGO">
    </form>
  </header>
</div>

<div>
<div class="post">
<h1 class="title">EGO 使用手册</h1>
<div id="table-of-contents">
<h2>&#30446;&#24405;</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgheadline1">介绍</a></li>
<li><a href="#orgheadline9">使用方法</a>
<ul>
<li><a href="#orgheadline2">安装</a></li>
<li><a href="#orgheadline3">设置</a></li>
<li><a href="#orgheadline4">新建 Repository</a></li>
<li><a href="#orgheadline5">新建文章</a></li>
<li><a href="#orgheadline6">测试单独文章的 html 页面</a></li>
<li><a href="#orgheadline7">发布</a></li>
<li><a href="#orgheadline8">异步发布</a></li>
</ul>
</li>
<li><a href="#orgheadline10">注意事项</a></li>
<li><a href="#orgheadline11">一些特点</a></li>
<li><a href="#orgheadline12">一些缺点</a></li>
<li><a href="#orgheadline13">待完成事项</a></li>
</ul>
</div>
</div>

<div id="outline-container-orgheadline1" class="outline-2">
<h2 id="orgheadline1">介绍</h2>
<div class="outline-text-2" id="text-orgheadline1">
<p>
EGO 是一个由 <a href="https://github.com/kelvinh/org-page">org-page</a> 和 <a href="https://github.com/tumashu/org-webpage">org-webpage</a> 派生出来的项目，是一个基于 Emacs、git 服务和 org-mode 的一个静态站点生成器。（什么是静态站点生成器？google、bing 或者百度一下）
</p>

<p>
本项目依据 <a href="http://www.gnu.org/licenses/gpl.html">GPL</a> 许可证（GNU General Public License）发布。
</p>
</div>
</div>

<div id="outline-container-orgheadline9" class="outline-2">
<h2 id="orgheadline9">使用方法</h2>
<div class="outline-text-2" id="text-orgheadline9">
</div><div id="outline-container-orgheadline2" class="outline-3">
<h3 id="orgheadline2">安装</h3>
<div class="outline-text-3" id="text-orgheadline2">
<p>
暂时不支持 melpa 安装，请用 <code>git clone</code> 后处理。
</p>
</div>
</div>

<div id="outline-container-orgheadline3" class="outline-3">
<h3 id="orgheadline3">设置</h3>
<div class="outline-text-3" id="text-orgheadline3">
<p>
下面是 emacs-china 的设置，安装好 <a href="https://github.com/emacs-china/EGO">EGO</a> 后，将该设置写入配置即可管理 emacs-china。
</p>

<p>
CAUTION: 直接 clone emacs-china 后，需要 checkout master 和 source 后才能使用 emacs-china，否则会导致意外情况。
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp"><span style="color: #74af68;">;; </span><span style="color: #74af68;">the following is only needed if you install EGO manually</span>
<span style="color: #8c8c8c;">(</span>add-to-list 'load-path <span style="color: #e67128;">"path/to/EGO"</span><span style="color: #8c8c8c;">)</span>

<span style="color: #8c8c8c;">(</span><span style="color: #ffad29; font-weight: bold;">require</span> '<span style="color: #008b8b;">ego</span><span style="color: #8c8c8c;">)</span>

<span style="color: #8c8c8c;">(</span>ego/add-to-alist 'ego/project-config-alist
               `<span style="color: #93a8c6;">(</span><span style="color: #b0b1a3;">(</span><span style="color: #e67128;">"emacs-china"</span> <span style="color: #74af68;">; </span><span style="color: #74af68;">&#31449;&#28857;&#24037;&#31243;&#30340;&#21517;&#23383;</span>
                 <span style="color: #23d7d7;">:repository-directory</span> <span style="color: #e67128;">"~/github/emacs-china.github.io"</span> <span style="color: #74af68;">; </span><span style="color: #74af68;">&#31449;&#28857;&#30340;&#26412;&#22320;&#30446;&#24405;</span>
                 <span style="color: #23d7d7;">:site-domain</span> <span style="color: #e67128;">"http://emacs-china.github.io/"</span> <span style="color: #74af68;">; </span><span style="color: #74af68;">&#31449;&#28857;&#30340;&#32593;&#22336;</span>
                 <span style="color: #23d7d7;">:site-main-title</span> <span style="color: #e67128;">"EMACS-CHINA"</span> <span style="color: #74af68;">; </span><span style="color: #74af68;">&#31449;&#28857;&#30340;&#26631;&#39064;</span>
                 <span style="color: #23d7d7;">:site-sub-title</span> <span style="color: #e67128;">"=============&gt;&#38598;&#24605;&#24191;&#30410;"</span> <span style="color: #74af68;">; </span><span style="color: #74af68;">&#31449;&#28857;&#30340;&#21103;&#26631;&#39064;</span>
                 <span style="color: #23d7d7;">:theme</span> <span style="color: #97b098;">(</span>default<span style="color: #97b098;">)</span> <span style="color: #74af68;">; </span><span style="color: #74af68;">&#20351;&#29992;&#30340;&#20027;&#39064;</span>
                 <span style="color: #23d7d7;">:summary</span> <span style="color: #97b098;">(</span><span style="color: #aebed8;">(</span><span style="color: #e67128;">"years"</span> <span style="color: #23d7d7;">:year</span> <span style="color: #23d7d7;">:updates</span> <span style="color: #008b8b;">10</span><span style="color: #aebed8;">)</span> <span style="color: #aebed8;">(</span><span style="color: #e67128;">"authors"</span> <span style="color: #23d7d7;">:authors</span><span style="color: #aebed8;">)</span> <span style="color: #aebed8;">(</span><span style="color: #e67128;">"tags"</span> <span style="color: #23d7d7;">:tags</span><span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span> <span style="color: #74af68;">; </span><span style="color: #74af68;">&#23548;&#33322;&#26639;&#30340;&#35774;&#32622;&#65292;&#26377; category &#21644; summary &#20004;&#31181;</span>
                 <span style="color: #23d7d7;">:source-browse-url</span> <span style="color: #97b098;">(</span><span style="color: #e67128;">"Github"</span> <span style="color: #e67128;">"https://github.com/emacs-china"</span><span style="color: #97b098;">)</span> <span style="color: #74af68;">; </span><span style="color: #74af68;">&#20320;&#30340;&#24037;&#31243;&#28304;&#20195;&#30721;&#25152;&#22312;&#30340;&#20301;&#32622;</span>
                 <span style="color: #23d7d7;">:personal-disqus-shortname</span> <span style="color: #e67128;">"emacs-china"</span> <span style="color: #74af68;">; </span><span style="color: #74af68;">&#20351;&#29992; disqus &#35780;&#35770;&#21151;&#33021;&#30340;&#35805;&#65292;&#23427;&#30340;&#30701;&#21517;&#31216;</span>
                 <span style="color: #23d7d7;">:personal-duoshuo-shortname</span> <span style="color: #e67128;">"emacs-china"</span> <span style="color: #74af68;">; </span><span style="color: #74af68;">&#20351;&#29992; &#22810;&#35828; &#35780;&#35770;&#21151;&#33021;&#30340;&#35805;&#65292;&#23427;&#30340;&#30701;&#21517;&#31216;</span>
                 <span style="color: #23d7d7;">:confound-email</span> nil <span style="color: #74af68;">; </span><span style="color: #74af68;">&#26159;&#21542;&#20445;&#25252;&#37038;&#20214;&#21517;&#31216;&#21602;&#65311;t &#26159;&#20445;&#25252;&#65292;nil &#26159;&#19981;&#20445;&#25252;&#65292;&#40664;&#35748;&#26159;&#20445;&#25252;</span>
                 <span style="color: #23d7d7;">:ignore-file-name-regexp</span> <span style="color: #e67128;">"readme.org"</span> <span style="color: #74af68;">; </span><span style="color: #74af68;">&#26377;&#20123;&#19981;&#24819;&#21457;&#24067;&#25104; html &#30340; org &#25991;&#20214;&#65288;&#20294;&#26159;&#21448;&#24819;&#34987;&#23548;&#20837; git &#36827;&#34892;&#31649;&#29702;&#65289;&#65292;&#21487;&#20197;&#29992;&#36825;&#31181;&#27491;&#21017;&#34920;&#36798;&#30340;&#26041;&#24335;&#25490;&#38500;</span>
                 <span style="color: #23d7d7;">:web-server-docroot</span> <span style="color: #e67128;">"~/webRoot/emacs-china.github.io"</span> <span style="color: #74af68;">; </span><span style="color: #74af68;">&#26412;&#22320;&#27979;&#35797;&#30340;&#30446;&#24405;</span>
                 <span style="color: #23d7d7;">:web-server-port</span> <span style="color: #008b8b;">5432</span><span style="color: #b0b1a3;">)</span><span style="color: #74af68;">; </span><span style="color: #74af68;">&#26412;&#22320;&#27979;&#35797;&#30340;&#31471;&#21475;</span>

                 <span style="color: #74af68;">;; </span><span style="color: #74af68;">&#20320;&#21487;&#20197;&#22312;&#27492;&#28155;&#21152;&#26356;&#22810;&#30340;&#31449;&#28857;&#35774;&#32622;</span>
               <span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
</pre>
</div>

<p>
TIP: 你可以仿照上面来设置自己的站点。
</p>

<p>
你可以通过以下方式发现 EGO 的设置方法（英文）
</p>

<pre class="example">
C-h v ego/project-config-alist
C-h v ego/config-fallback
</pre>
</div>
</div>

<div id="outline-container-orgheadline4" class="outline-3">
<h3 id="orgheadline4">新建 Repository</h3>
<div class="outline-text-3" id="text-orgheadline4">
<p>
通过以下方式创建新的 Repository（也就是一个新站点了）：
</p>

<pre class="example">
M-x ego/new-repository
</pre>

<p>
这种方式只能进行一个初级的设置，要想让它正常工作，还是需要设置 <code>ego/project-config-alist</code> 变量。
</p>
</div>
</div>

<div id="outline-container-orgheadline5" class="outline-3">
<h3 id="orgheadline5">新建文章</h3>
<div class="outline-text-3" id="text-orgheadline5">
<p>
用以下方式创建新文章：
</p>

<pre class="example">
M-x ego/new-post
</pre>
</div>
</div>

<div id="outline-container-orgheadline6" class="outline-3">
<h3 id="orgheadline6">测试单独文章的 html 页面</h3>
<div class="outline-text-3" id="text-orgheadline6">
<p>
使用以下命令可以生成当前 org 文件所对应的 html 文件，并浏览：
</p>

<pre class="example">
M-x ego/test-current-page
</pre>
</div>
</div>

<div id="outline-container-orgheadline7" class="outline-3">
<h3 id="orgheadline7">发布</h3>
<div class="outline-text-3" id="text-orgheadline7">
<p>
用以下命令生成 html 文件，并按需传送到远程端：
</p>

<pre class="example">
M-x ego/do-publication
</pre>

<p>
这条命令会问你如下几个问题：
</p>
<ol class="org-ol">
<li>Which project do you want to publish? <br  />
~ <b>发布哪个站点？</b></li>
<li>Choose a job from the jobs below: <br  />
~ "1. Test partial publish" <br  />
~ "2. Partial publish" <br  />
~ "3. Test full publish" <br  />
~ "4. Full publish" <br  />
~ <b>从以下四个选项里选择一种发布方式：</b> <br  />
~ "1. 增量发布测试" <br  />
~ "2. 增量发布" <br  />
~ "3. 完全发布测试" <br  />
~ "4. 完全发布" <br  />
~ 测试即意味着发布到 web-server-docroot 文件夹下用 emacs 自带的 web server 查看，是本地的并不传送到远端。</li>
<li>(when (2) is partial) Base git commit: HEAD~1 ? <br  />
~ <b>将哪些提交视为改变文件？（当第三项选了带了 “partial” 字符串时出现的选项，不懂得话回车即可）</b></li>
<li>Input checkin messages. (The message won't be inputted if you have checkined before.) <br  />
~ <b>输入 checkin 信息，了解 git 的话应该知道</b></li>
<li>(when (2) is not "test") There will be some questions for "publish-config" <br  />
~ <b>对发布到远端的设置进行具体询问（在第二项没有 “test” 字符串时出现）</b></li>
</ol>

<p>
<b>注意</b>: 当进行没测试过的发布时，任何未经测试的内容变化都不会被发布。也即，任何内容变化在真正发布之前必须经过测试发布。
</p>

<p>
你可以在 <b>message</b> buffer 和 <b>EGO OUTPUT</b> buffer 里跟踪整个过程。
</p>
</div>
</div>

<div id="outline-container-orgheadline8" class="outline-3">
<h3 id="orgheadline8">异步发布</h3>
<div class="outline-text-3" id="text-orgheadline8">
<p>
你可以使用 <code>async.el</code> 包来包裹 <code>ego/do-publication</code> 命令，使得该命令异步执行。
</p>

<p>
关于 <code>async.el</code> 包的用法可以参看这里（英文） : <a href="https://github.com/jwiegley/emacs-async">Async</a>.
</p>

<p>
这里是一个例子: (你当然不能直接使用它，但是可以参考它进行自己的设置，就当是一个使用 async 的作业吧)
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp"><span style="color: #8c8c8c;">(</span><span style="color: #ffad29; font-weight: bold;">require</span> '<span style="color: #008b8b;">async</span><span style="color: #8c8c8c;">)</span>
<span style="color: #8c8c8c;">(</span><span style="color: #ffad29; font-weight: bold;">defun</span> <span style="color: #00ede1; font-weight: bold;">ego/async-do-publish</span> <span style="color: #93a8c6;">(</span><span style="color: #34cae2;">&amp;optional</span> project-name
                                       test-and-not-publish
                                       force-all
                                       base-git-commit
                                       checkin-all
                                       publish-all<span style="color: #93a8c6;">)</span>
  <span style="color: #93a8c6;">(</span><span style="color: #ffad29; font-weight: bold;">interactive</span>
   <span style="color: #b0b1a3;">(</span><span style="color: #ffad29; font-weight: bold;">let*</span> <span style="color: #97b098;">(</span><span style="color: #aebed8;">(</span>j <span style="color: #b0b0b3;">(</span><span style="color: #ffad29; font-weight: bold;">or</span> ego/default-project-name
                 <span style="color: #90a890;">(</span>completing-read <span style="color: #e67128;">"Which project do you want to publish? "</span>
                                  <span style="color: #a2b6da;">(</span>delete-dups
                                   <span style="color: #9cb6ad;">(</span>mapcar 'car ego/project-config-alist<span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span>
                                  nil t nil nil ego/last-project-name<span style="color: #90a890;">)</span><span style="color: #b0b0b3;">)</span><span style="color: #aebed8;">)</span>
          <span style="color: #aebed8;">(</span>p <span style="color: #b0b0b3;">(</span>y-or-n-p <span style="color: #e67128;">"Action:  [Yes] Test, [No] Tested Publish. "</span><span style="color: #b0b0b3;">)</span><span style="color: #aebed8;">)</span>
          <span style="color: #aebed8;">(</span>f <span style="color: #b0b0b3;">(</span>y-or-n-p <span style="color: #90a890;">(</span>format <span style="color: #e67128;">"Publish all org files of \"%s\" project? "</span> j<span style="color: #90a890;">)</span><span style="color: #b0b0b3;">)</span><span style="color: #aebed8;">)</span>
          <span style="color: #aebed8;">(</span>b <span style="color: #b0b0b3;">(</span><span style="color: #ffad29; font-weight: bold;">unless</span> f <span style="color: #90a890;">(</span>read-string <span style="color: #e67128;">"Base git commit: "</span> <span style="color: #e67128;">"HEAD~1"</span><span style="color: #90a890;">)</span><span style="color: #b0b0b3;">)</span><span style="color: #aebed8;">)</span>
          <span style="color: #aebed8;">(</span>c <span style="color: #b0b0b3;">(</span>read-string <span style="color: #e67128;">"checkin message (won't show in 'git log' if you have committed all): "</span><span style="color: #b0b0b3;">)</span><span style="color: #aebed8;">)</span>
          <span style="color: #aebed8;">(</span>a nil<span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span>
     <span style="color: #97b098;">(</span>list j p f b c a<span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span>
  <span style="color: #74af68;">;; </span><span style="color: #74af68;">set ego remote push (publish-config) &#36828;&#31471;&#21457;&#24067;&#30340;&#35774;&#32622;</span>
  <span style="color: #93a8c6;">(</span><span style="color: #ffad29; font-weight: bold;">unless</span> test-and-not-publish
    <span style="color: #b0b1a3;">(</span><span style="color: #ffad29; font-weight: bold;">setq</span> ego/current-project-name project-name<span style="color: #b0b1a3;">)</span>
    <span style="color: #b0b1a3;">(</span><span style="color: #ffad29; font-weight: bold;">setq</span> ego/last-project-name project-name<span style="color: #b0b1a3;">)</span>
    <span style="color: #b0b1a3;">(</span><span style="color: #ffad29; font-weight: bold;">setq</span> publish-config
          <span style="color: #97b098;">(</span>ego/git-get-publish-config <span style="color: #aebed8;">(</span>ego/get-repository-directory<span style="color: #aebed8;">)</span>
                                      <span style="color: #aebed8;">(</span>ego/get-config-option <span style="color: #23d7d7;">:repository-org-branch</span><span style="color: #aebed8;">)</span>
                                      <span style="color: #aebed8;">(</span>ego/get-config-option <span style="color: #23d7d7;">:repository-html-branch</span><span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span>
  <span style="color: #93a8c6;">(</span>message <span style="color: #e67128;">"See *EGO OUTPUT* buffer and *emacs* buffer for information"</span><span style="color: #93a8c6;">)</span>

  <span style="color: #93a8c6;">(</span><span style="color: #ffad29; font-weight: bold;">async-start</span>
   `<span style="color: #b0b1a3;">(</span><span style="color: #ffad29; font-weight: bold;">lambda</span> <span style="color: #97b098;">()</span>
      <span style="color: #74af68;">;; </span><span style="color: #74af68;">load packages and set load-path &#36825;&#37324;&#24320;&#22987;&#35843;&#29992;&#26032;&#36827;&#31243;&#65292;&#22312;&#26032;&#36827;&#31243;&#30340;&#21457;&#24067;&#24320;&#22987;&#20043;&#21069;&#65292;&#38656;&#35201;&#37197;&#32622;&#26032;&#36827;&#31243;&#20351;&#24471; ego/do-publication &#21629;&#20196;&#27491;&#24120;&#24037;&#20316;</span>
      <span style="color: #97b098;">(</span><span style="color: #ffad29; font-weight: bold;">setq</span> package-user-dir ,<span style="color: #aebed8;">(</span>expand-file-name <span style="color: #e67128;">"~/.emacs.d/elpa/"</span><span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span>
      <span style="color: #97b098;">(</span>package-initialize<span style="color: #97b098;">)</span>
      <span style="color: #97b098;">(</span>add-to-list 'load-path ,<span style="color: #aebed8;">(</span>expand-file-name <span style="color: #e67128;">"~/github/org-mode/lisp"</span><span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span>
      <span style="color: #97b098;">(</span>add-to-list 'load-path ,<span style="color: #aebed8;">(</span>expand-file-name <span style="color: #e67128;">"~/github/org-mode/contrib/lisp"</span> t<span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span>
      <span style="color: #97b098;">(</span>add-to-list 'load-path ,ego/load-directory<span style="color: #97b098;">)</span>

      <span style="color: #74af68;">;;</span><span style="color: #74af68;">set color-theme</span>
      <span style="color: #97b098;">(</span>add-to-list 'load-path ,<span style="color: #aebed8;">(</span>expand-file-name <span style="color: #e67128;">"~/.emacs.d/color-theme-6.6.0"</span><span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span>
      <span style="color: #97b098;">(</span><span style="color: #ffad29; font-weight: bold;">require</span> '<span style="color: #008b8b;">color-theme-autoloads</span> <span style="color: #e67128;">"color-theme-autoloads"</span><span style="color: #97b098;">)</span>
      <span style="color: #97b098;">(</span>color-theme-initialize<span style="color: #97b098;">)</span>
      <span style="color: #97b098;">(</span>color-theme-dark-blue2<span style="color: #97b098;">)</span>

      <span style="color: #74af68;">;; </span><span style="color: #74af68;">set coding-system</span>
      <span style="color: #97b098;">(</span>set-terminal-coding-system 'utf-8-unix<span style="color: #97b098;">)</span>
      <span style="color: #97b098;">(</span>set-keyboard-coding-system 'utf-8-unix<span style="color: #97b098;">)</span>
      <span style="color: #97b098;">(</span>prefer-coding-system 'utf-8-unix<span style="color: #97b098;">)</span>
      <span style="color: #97b098;">(</span><span style="color: #ffad29; font-weight: bold;">setq</span> save-buffer-coding-system 'utf-8-unix
            coding-system-for-write 'utf-8-unix<span style="color: #97b098;">)</span>

      <span style="color: #74af68;">;; </span><span style="color: #74af68;">pre-set ego configurations</span>
      <span style="color: #97b098;">(</span><span style="color: #ffad29; font-weight: bold;">require</span> '<span style="color: #008b8b;">cl-lib</span><span style="color: #97b098;">)</span>
      <span style="color: #97b098;">(</span><span style="color: #ffad29; font-weight: bold;">require</span> '<span style="color: #008b8b;">ego</span><span style="color: #97b098;">)</span>
      <span style="color: #97b098;">(</span><span style="color: #ffad29; font-weight: bold;">setq</span> ego/project-config-alist ',ego/project-config-alist<span style="color: #97b098;">)</span>

      <span style="color: #74af68;">;; </span><span style="color: #74af68;">Make EGO show svg images</span>
      <span style="color: #97b098;">(</span><span style="color: #ffad29; font-weight: bold;">require</span> '<span style="color: #008b8b;">ox-html</span><span style="color: #97b098;">)</span>
      <span style="color: #97b098;">(</span><span style="color: #ffad29; font-weight: bold;">defun</span> <span style="color: #00ede1; font-weight: bold;">kd/org-html--format-image</span> <span style="color: #aebed8;">(</span>source attributes info<span style="color: #aebed8;">)</span>
        <span style="color: #e67128;">"Return \"img\" tag with given SOURCE and ATTRIBUTES.</span>
<span style="color: #e67128;">  SOURCE is a string specifying the location of the image.</span>
<span style="color: #e67128;">  ATTRIBUTES is a plist, as returned by</span>
<span style="color: #e67128;">  `</span><span style="color: #008b8b;">org-export-read-attribute</span><span style="color: #e67128;">'.  INFO is a plist used as</span>
<span style="color: #e67128;">  a communication channel."</span>
        <span style="color: #aebed8;">(</span>org-html-close-tag
         <span style="color: #e67128;">"img"</span>
         <span style="color: #b0b0b3;">(</span>org-html--make-attribute-string
          <span style="color: #90a890;">(</span>org-combine-plists
           <span style="color: #a2b6da;">(</span>list <span style="color: #23d7d7;">:src</span> source
                 <span style="color: #23d7d7;">:alt</span> <span style="color: #9cb6ad;">(</span><span style="color: #ffad29; font-weight: bold;">if</span> <span style="color: #8c8c8c;">(</span>string-match-p <span style="color: #e67128;">"^ltxpng/"</span> source<span style="color: #8c8c8c;">)</span>
                          <span style="color: #8c8c8c;">(</span>org-html-encode-plain-text
                           <span style="color: #93a8c6;">(</span>org-find-text-property-in-string 'org-latex-src source<span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
                        <span style="color: #8c8c8c;">(</span>file-name-nondirectory source<span style="color: #8c8c8c;">)</span><span style="color: #9cb6ad;">)</span><span style="color: #a2b6da;">)</span>
           attributes<span style="color: #90a890;">)</span><span style="color: #b0b0b3;">)</span>
         info<span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span>
      <span style="color: #97b098;">(</span>advice-add 'org-html--format-image <span style="color: #23d7d7;">:override</span> #'kd/org-html--format-image<span style="color: #97b098;">)</span>

      <span style="color: #74af68;">;; </span><span style="color: #74af68;">without org-to-html if possible</span>
      <span style="color: #97b098;">(</span><span style="color: #ffad29; font-weight: bold;">unless</span> ,test-and-not-publish
        <span style="color: #aebed8;">(</span><span style="color: #ffad29; font-weight: bold;">if</span> ,base-git-commit
            <span style="color: #b0b0b3;">(</span><span style="color: #ffad29; font-weight: bold;">setq</span> ego/publish-without-org-to-html <span style="color: #008b8b;">1</span><span style="color: #b0b0b3;">)</span>
          <span style="color: #b0b0b3;">(</span><span style="color: #ffad29; font-weight: bold;">setq</span> ego/publish-without-org-to-html <span style="color: #008b8b;">2</span><span style="color: #b0b0b3;">)</span><span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span>

      <span style="color: #74af68;">;; </span><span style="color: #74af68;">ego/do-publication here &#27880;&#24847;&#65306;&#36825;&#37324;&#24320;&#22987;&#26159;&#26032;&#36827;&#31243;&#30340;&#21457;&#24067;&#21629;&#20196;</span>
      <span style="color: #97b098;">(</span>ego/do-publication ,project-name
                          ,test-and-not-publish
                          ,force-all
                          ,base-git-commit
                          ,checkin-all
                          ,publish-all<span style="color: #97b098;">)</span>

      <span style="color: #74af68;">;; </span><span style="color: #74af68;">waiting for push remote success or just wait http-server in which case you have to close *emacs* buffer manually</span>
      <span style="color: #97b098;">(</span><span style="color: #ffad29; font-weight: bold;">while</span> <span style="color: #aebed8;">(</span>not ego/async-publish-success<span style="color: #aebed8;">)</span>
        <span style="color: #aebed8;">(</span>sit-for <span style="color: #008b8b;">1</span><span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span>

      <span style="color: #74af68;">;; </span><span style="color: #74af68;">return the result &#36820;&#22238;&#32467;&#26524;</span>
      <span style="color: #97b098;">(</span><span style="color: #ffad29; font-weight: bold;">with-current-buffer</span> <span style="color: #aebed8;">(</span>get-buffer-create ,ego/temp-buffer-name<span style="color: #aebed8;">)</span>
        <span style="color: #aebed8;">(</span>buffer-string<span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span>
      <span style="color: #b0b1a3;">)</span>
   `<span style="color: #b0b1a3;">(</span><span style="color: #ffad29; font-weight: bold;">lambda</span> <span style="color: #97b098;">(</span>result<span style="color: #97b098;">)</span>
      <span style="color: #97b098;">(</span><span style="color: #ffad29; font-weight: bold;">with-current-buffer</span> <span style="color: #aebed8;">(</span>get-buffer-create ego/temp-buffer-name<span style="color: #aebed8;">)</span>
        <span style="color: #aebed8;">(</span>insert <span style="color: #b0b0b3;">(</span>format <span style="color: #e67128;">"*EGO output* should be :\n %s \nego/async-do-publish done!"</span> result<span style="color: #b0b0b3;">)</span><span style="color: #aebed8;">)</span><span style="color: #97b098;">)</span><span style="color: #b0b1a3;">)</span><span style="color: #93a8c6;">)</span><span style="color: #8c8c8c;">)</span>
</pre>
</div>

<p>
你可以在 <b>emacs</b> buffer 和 <b>EGO OUTPUT</b> buffer 里跟踪整个过程。
</p>
</div>
</div>
</div>

<div id="outline-container-orgheadline10" class="outline-2">
<h2 id="orgheadline10">注意事项</h2>
<div class="outline-text-2" id="text-orgheadline10">
<p>
在我最新编译的 emacs 里，发现如果用 dired 打开了 repository 里面一些目录，这时 EGO 自带的 git change branch 无法正确地切换 branch。造成 repository 里文件混乱。
</p>

<p>
解决办法：关闭那些被打开的 repository 内部目录的 buffer。（repository 这个目录倒是没什么关系。）
</p>
</div>
</div>

<div id="outline-container-orgheadline11" class="outline-2">
<h2 id="orgheadline11">一些特点</h2>
<div class="outline-text-2" id="text-orgheadline11">
<p>
EGO 还支持 “主题继承”，能让多站点管理时的主题修改轻松很多。这里只点一下要点：
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp"><span style="color: #23d7d7;">:theme</span> <span style="color: #8c8c8c;">(</span>haru emacs_love<span style="color: #8c8c8c;">)</span>
</pre>
</div>

<p>
<code>haru</code> 是在 <code>emacs_love</code> 上修改的主题。实际上 <code>:theme</code> 对应的括号里可以有很多主题，形成一个主题链（越开头越优先）。
</p>
</div>
</div>

<div id="outline-container-orgheadline12" class="outline-2">
<h2 id="orgheadline12">一些缺点</h2>
<div class="outline-text-2" id="text-orgheadline12">
<p>
假若要删除发布后的 html 文件，只能用 git 跳转到 html 所在分支，进行手动删除后，将该分支提交到服务器端。
</p>

<p>
也即是说，删除发布后的 html 文件比较麻烦。（使用传统的 git 操作模式）
</p>
</div>
</div>

<div id="outline-container-orgheadline13" class="outline-2">
<h2 id="orgheadline13">待完成事项</h2>
<div class="outline-text-2" id="text-orgheadline13">
<p>
目前只有一个 default 主题，试试看能否公开招募到新主题，然后维护一个主题的超链接列表。
</p>

<p>
如有问题请移步 <a href="https://github.com/emacs-china/EGO/issues">Issues</a> 提问
</p>
</div>
</div>

</div>
</div>
<div>
  <script src="http://emacs-china.github.io/EGO/media/js/jquery-2.1.3.min.js"></script>
  <script src="http://emacs-china.github.io/EGO/media/js/main.js"></script>
  <div class="footer">
    <p>Generated by <a href="http://www.gnu.org/software/emacs/">Emacs</a> 25.x(<a href="http://orgmode.org">Org mode</a> 8.x)</p>
    <p>
      Copyright &copy; 2014 - <span id="footerYear"></span> <a href="mailto:kuangdash &lt;at&gt; 163 &lt;dot&gt; com">皐月中二</a>
      &nbsp;&nbsp;-&nbsp;&nbsp;
      Powered by <a href="https://github.com/emacs-china/ego" target="_blank">EGO</a><br/>
      <a href="http://creativecommons.org/licenses/by-sa/3.0/" rel="license"><img src="http://i.creativecommons.org/l/by-sa/3.0/88x31.png" style="border-width:0" alt="Creative Commons License" class="center"></a>
      <script type="text/javascript">document.getElementById("footerYear").innerHTML = (new Date()).getFullYear();</script>
    </p>
  </div>
    </div>

  </div></body>
</html>
